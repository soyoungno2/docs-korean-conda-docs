===================
콘다 빌드 래시피
===================

:doc:`콘다와 콘다 빌드(conda build)를 설치하고 업데이트 <install-conda-build_ko>`\ 해야 콘파 패키지를 빌드할 수 있다.

콘다 패키지를 빌드하려면 래시피가 있어야 한다. 콘다 빌드 래시피는 다음 파일을 포함하는 단층 디렉토리다.

* ``meta.yaml``---래시피의 모든 메타데이터를 포함하는 파일이다.
  ``package/name``\ 과 ``package/version``\ 만이 필수 사항이다.

* ``build.sh``---맥OS와 리눅스에 패키지 파일을 설치하는 빌드 스크립트다. ``bash`` 명령으로 실행된다.

* ``bld.bat``---윈도우에 패키지 파일을 설치하는 빌드 스크립트다. ``cmd``\ 로 실행된다.

* ``run_test.[py,pl,sh,bat]``---파이썬 테스트 파일로 선택 사항이다. 래시피에 들어가 있으면 자동으로 실행된다.

* 소스에 적용되는 선택적 패치 파일.

* 소스에 포함되지 않으면서 빌드 스크립트로 생성할 수 없는 다른 리소스. 예시로는 아이콘 파일, 리드미(readme) 파일, 빌드 노트가 있다.

팁: `conda skeleton <skeleton_ref>` 명령을 사용하면 ``meta.yaml``, ``build.sh``, ``bld.bat`` 파일이 자동으로 생성된다.


콘다 빌드 과정
====================

``conda-build`` 명령은 다음 단계를 수행한다.

#. 메타데이터를 읽는다.

#. 캐시에 소스를 다운로드한다.

#. 소스 디렉토리로 소스를 추출한다.

#. 패치가 있다면 적용한다.

#. 메타데이터 값을 채우기 위해 소스가 필요하면 메타데이터를 다시 검사한다.

#. 빌드 환경을 생성하고 그 환경에 빌드 의존 요소를 설치한다.

#. 빌드 스크립트를 실행한다. 현재 작업 디렉토리가 환경 변수 모음을 포함하는 소스 디렉토리가 된다. 빌드 스크립트는 빌드 환경에 설치한다.

#. shebang과 rpath와 같은 필요한 작업 후 단계를 진행한다.

#. 필수 콘다 패키지 메타데이터와 5단계에서 빌드 환경에 설치된 모든 파일을 포함한 콘다 패키지를 생성한다.

#. 래시피에 테스트 스크립트가 포함되어 있으면 콘다 패키지를 테스트한다.

   #. 빌드 환경을 삭제한다.

   #. 패키지와 의존 요소를 포함하는 테스트 환경을 생성한다.

   #. 테스트 스크립트를 실행한다.

`콘다 래시피 <https://github.com/continuumio/conda-recipes>`_ 레포지토리에 여러 콘다 패키지의 래시피 예시가 있다.

경고: ``meta.yaml``\ 과 빌드 스크립트를 포함한 모든 래시피 파일은 사용자에게 배포될 최종 패키지 저장소(archive)에 포함되어야 한다.
공개될 수 있는 위치에 암호와 같은 민감한 정보를 넣지 않도록 주의한다.

`conda skeleton <skeleton_ref>` 명령은 `PyPI <https://pypi.python.org/pypi>`_\ 와 같이
일반적으로 사용되는 레포지토리를 위한 래시피를 만드는데 도움이 될 수 있다.
