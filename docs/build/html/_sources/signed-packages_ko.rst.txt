======================
콘다 패키지 서명
======================

**PREVIEW RELEASE**

콘다는 콘다 패키지의 RSA 서명을 인증할 수 있다. conda-build 는 키 쌍의 생성, 콘다 패키지 서명, 콘다 저장소 인덱스에 요구되는 패키지 메타데이터 추가를 할 수 있다. 키 사이즈에는 제한이 없고 디폴트는 2048 bits 이다.

주어진 공개/개인 키 쌍에 대해 개인 키를 사용하는 어떤 파일도 서명할 수 있고 이 파일을 받는 다른 사용자가 파일을 사용하려면 공용키에 서명을 인증해야 한다. 서명을 인증한 사용자는 서명 또한 개인 키에 의해 생성 됐음을 보장받는다.

요구사항
=============

- 콘다 빌드 설치
- 루트 환경에 PyCrypto 설치
- 콘다 패키지 빌드 경험
- "conda index" 커맨드를 사용해 직접 콘다 저장소를 설정해 본 경험
- 공개/개인 키 암호화의 기초에 익숙함
- 전자 서명의 개념에 대한 이해

패키지 요약 서명
========================

서명된 콘다 패키지 빌드는 다음 단계로 진행된다.:

#. 공개/개인 키 쌍 생성.
#. "conda sign" 커맨드를 사용한 패키지 서명.
#. 서명의 유효성 검증.
#. 저장소 인덱싱.
#. 서명된 패키지 사용.

1단계: 공개/개인 키 쌍 생성.
============================================

먼저 공개/개인 키 쌍을 생성한다. 각각의 키 쌍에 명칭을 지정한다. 지정된 명칭은 서명 파일에 저장되어 클라이언트로 하여금 어떤 공개 키가 서명을 인증하는지 알 수 있도록 한다. 이번 예시에서 공개 키는 MyKey 로 명명된다.:
::

    conda sign --keygen MyKey

주의: "MyKey" 를 실제로 사용하고자 하는 키 쌍의 명칭으로 대체한다.

2 단계: 패키지 서명.
===========================

서명할 콘다 패키지를 "conda sign" 커맨드로 보냄으로써 손쉽게 패키지 서명을 할 수 있다. 예를 들어, Linux-64 디렉토리의 모든 패키지를 서명하고 싶다면:
::

    cd <repository>/linux-64
    conda sign *.tar.bz2

모든 콘다 패키지 옆에 `.sig` 파일을 확인할 수 있을 것이다.

주의: 모든 콘다 패키지에 서명할 필요는 없다.; 서명하고자 하는 패키지를 고르면 된다.

3 단계: 서명이 유효한지 확인한다.
================================================

서명이 유효한지 확인하기 위해 conda sign verify 커맨드를 실행한다.:
::

    conda sign --verify *.tar.bz2

4 단계: 저장소 인덱싱
===============================

이제 `conda index` 커맨드를 실행해 `repodata.json` 파일을 업데이트 (또는 생성) 한다.:
::

    conda index

콘다 저장소의 서명이 끝났다.

5 단계: 서명된 패키지 사용
===================================

서명된 패키지를 사용하려면 패키지를 설치하기 전에 저장소에 접근해 공용 키 파일을 `~/.conda/keys` 디렉토리에 추가해야 한다. 예시:
::

    mkdir -p ~/.conda/keys
    cp <some download folder>/foo.pub ~/.conda/keys

`conda` 커맨드로 서명된 패키지를 설치하려 하면 콘다는 서명 인증을 시도할 것이다.

- 콘다가 서명을 찾으면 설치를 허용한다.
- 다음과 같은 경우에 콘다는 설치를 종료한다. (i) 서명이 유요하지 않은 경우. (ii) 서명을 발견할 수 없는 경우. (iii) 공용 키가 설치되지 않은 경우.
